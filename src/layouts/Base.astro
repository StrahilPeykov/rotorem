---
import { SEO } from 'astro-seo';
import { getLangFromUrl, useTranslations, getRouteFromUrl, getLocalizedPath } from '../i18n/utils';
import LanguageToggle from '../components/LanguageToggle.astro';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  noindex?: boolean;
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const isEN = lang === 'en';

const {
  title = isEN ? 'TechnoFix Varna | Appliance Repair Services' : 'ТехноФикс Варна | Ремонт на битова техника',
  description = isEN 
    ? 'Professional appliance repair services in Varna. Fast and reliable repairs for washing machines, refrigerators, air conditioners and more.'
    : 'Професионален ремонт на битова техника във Варна. Бързи и надеждни ремонти на перални, хладилници, климатици и други.',
  image = '/img/hero.webp',
  noindex = false,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const route = getRouteFromUrl(Astro.url);
const alternateURL = new URL(getLocalizedPath(route, lang === 'bg' ? 'en' : 'bg'), Astro.site);
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    
    {noindex && <meta name="robots" content="noindex" />}
    
    <SEO
      title={title}
      description={description}
      canonical={canonicalURL.toString()}
      openGraph={{
        basic: {
          title,
          type: 'website',
          image,
        },
        optional: {
          description,
          locale: lang,
          siteName: isEN ? 'TechnoFix Varna' : 'ТехноФикс Варна',
        },
      }}
      extend={{
        link: [
          {
            rel: 'alternate',
            hreflang: lang === 'bg' ? 'en' : 'bg',
            href: alternateURL.toString(),
          },
        ],
        meta: [
          { name: 'twitter:card', content: 'summary_large_image' },
          { name: 'twitter:title', content: title },
          { name: 'twitter:description', content: description },
        ],
      }}
    />
    
    <!-- LocalBusiness Schema -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "TechnoFix Varna",
        "alternateName": "ТехноФикс Варна",
        "description": "Professional appliance repair services in Varna",
        "url": "https://technofixvarna.com",
        "telephone": "+359878123456",
        "email": "contact@technofixvarna.com",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Varna",
          "addressRegion": "Varna",
          "addressCountry": "BG"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 43.2141,
          "longitude": 27.9147
        },
        "openingHoursSpecification": [
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
            "opens": "09:00",
            "closes": "18:00"
          },
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": "Saturday",
            "opens": "10:00",
            "closes": "14:00"
          }
        ],
        "priceRange": "$$",
        "image": "https://technofixvarna.com/img/hero.webp",
        "sameAs": [
          "https://www.facebook.com/technofixvarna",
          "https://www.google.com/maps?cid=12345678"
        ]
      }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style is:global>
      @tailwind base;
      @tailwind components;
      @tailwind utilities;
      
      :root {
        --color-primary: #2563eb;
        --color-primary-dark: #1d4ed8;
        --color-accent: #f59e0b;
        --color-bg: #f9fafb;
        --color-text: #111827;
        --color-text-light: #4b5563;
      }
      
      html {
        scroll-behavior: smooth;
        font-family: 'Inter', sans-serif;
        background-color: var(--color-bg);
        color: var(--color-text);
      }
      
      @layer components {
        .container {
          @apply max-w-6xl mx-auto px-4 sm:px-6;
        }
        
        .btn-primary {
          @apply bg-primary hover:bg-primary-dark text-white font-medium py-3 px-6 rounded-lg transition-colors;
        }
        
        .btn-cta {
          @apply bg-accent hover:bg-amber-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors;
        }
        
        .input {
          @apply w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all;
        }
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-50">
    <header class="py-4 bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
      <div class="container flex justify-between items-center">
        <a href={isEN ? '/en' : '/'} class="font-bold text-2xl text-primary">
          {isEN ? 'TechnoFix Varna' : 'ТехноФикс Варна'}
        </a>
        <div class="flex gap-8 items-center">
          <nav class="hidden md:flex gap-6">
            <a href="#services" class="hover:text-primary font-medium">
              {t('nav.services')}
            </a>
            <a href="#reviews" class="hover:text-primary font-medium">
              {t('nav.reviews')}
            </a>
            <a href="#contact" class="hover:text-primary font-medium">
              {t('nav.contact')}
            </a>
          </nav>
          <LanguageToggle />
        </div>
      </div>
    </header>
    
    <main>
      <slot />
    </main>
    
    <footer class="bg-gray-100 py-10 mt-16 border-t border-gray-200">
      <div class="container">
        <div class="flex flex-col md:flex-row justify-between items-center gap-6">
          <div>
            <p class="font-semibold text-lg text-gray-800">
              {isEN ? 'TechnoFix Varna' : 'ТехноФикс Варна'}
            </p>
            <p class="text-gray-600 mt-1">
              {isEN ? 'Professional appliance repair services' : 'Професионален ремонт на битова техника'}
            </p>
          </div>
          
          <div class="text-center md:text-right">
            <p class="text-gray-600">
              &copy; {new Date().getFullYear()} TechnoFix Varna
            </p>
            <p class="text-gray-500 text-sm mt-1">
              <span>MIT © 2025 Strahil Peykov</span>
            </p>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>