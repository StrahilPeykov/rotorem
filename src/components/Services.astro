---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

// Define a type for valid icon keys
type IconKey = 'washing-machine' | 'refrigerator' | 'air-conditioner' | 'dishwasher' | 'oven' | 'electrical' | 'other';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const isEN = lang === 'en';

// Enhanced styling for the section
const sectionClass = "py-24 bg-gradient-to-b from-blue-50 to-white relative overflow-hidden";
const titleClass = "text-4xl font-bold text-primary mb-2";
const subtitleClass = "mt-4 text-xl text-gray-600 max-w-3xl mx-auto";

// Color overlays for each service type - consistent style with original design
const serviceColors = {
  'washing-machine': 'from-blue-700/70 to-blue-600/70',
  'refrigerator': 'from-cyan-700/70 to-cyan-600/70',
  'air-conditioner': 'from-teal-700/70 to-teal-600/70',
  'dishwasher': 'from-emerald-700/70 to-emerald-600/70',
  'oven': 'from-amber-700/70 to-amber-600/70', 
  'electrical': 'from-red-700/70 to-red-600/70',
};

// Adding the service area information
const serviceArea = isEN 
  ? 'Serving Varna and surrounding areas (up to 20km)'
  : 'Обслужваме Варна и околностите (до 20км)';

// Service guarantee text
const guaranteeText = isEN
  ? 'All repairs come with professional service and warranty'
  : 'Всички ремонти се извършват професионално и с гаранция';

const services = [
  {
    icon: 'washing-machine' as IconKey,
    title: isEN ? 'Washing Machines & Dryers' : 'Перални и Сушилни',
    description: isEN 
      ? 'Fast repairs for all washing machine brands. We fix leaks, motor problems, electronics, and provide same-day emergency service.'
      : 'Бързи ремонти на всички марки перални. Отстраняваме течове, проблеми с мотора, електрониката и предлагаме спешна услуга в същия ден.',
  },
  {
    icon: 'refrigerator' as IconKey,
    title: isEN ? 'Refrigerators & Freezers' : 'Хладилници и Фризери',
    description: isEN 
      ? 'Professional refrigerator repair with quality parts. Freon recharge, compressor repairs, and temperature regulation issues fixed quickly.'
      : 'Професионален ремонт на хладилници с качествени части. Бързо отстраняване на проблеми със зареждане с фреон, ремонт на компресори и регулиране на температурата.',
  },
  {
    icon: 'air-conditioner' as IconKey,
    title: isEN ? 'Air Conditioners' : 'Климатици',
    description: isEN 
      ? 'Complete AC services: installation, maintenance, and repairs with warranty. Expert refrigerant handling and electrical diagnostics.'
      : 'Пълно обслужване на климатици: монтаж, поддръжка и ремонт с гаранция. Експертна работа с хладилен агент и електрическа диагностика.',
  },
  {
    icon: 'dishwasher' as IconKey,
    title: isEN ? 'Dishwashers' : 'Съдомиялни',
    description: isEN 
      ? 'Reliable dishwasher repairs for all major brands. We fix water inlet problems, draining issues, and electronics with genuine parts.'
      : 'Надежден ремонт на съдомиялни от всички основни марки. Отстраняваме проблеми с подаването на вода, източването и електрониката с оригинални части.',
  },
  {
    icon: 'oven' as IconKey,
    title: isEN ? 'Ovens & Water Heaters' : 'Фурни и Бойлери',
    description: isEN 
      ? 'Expert repairs for electric and gas ovens, cooktops, and water heaters. Heating elements, thermostats, and control boards fixed with warranty.'
      : 'Експертен ремонт на електрически и газови фурни, котлони и бойлери. Нагревателни елементи, термостати и контролни платки се ремонтират с гаранция.',
  },
  {
    icon: 'electrical' as IconKey,
    title: isEN ? 'Electrical Services' : 'Електрически Услуги',
    description: isEN 
      ? 'Installation and replacement of switches, sockets, light fixtures, and small electrical appliances. Safe, reliable, and code-compliant work.'
      : 'Монтаж и подмяна на ключове, контакти, осветителни тела и малки електрически уреди. Безопасна, надеждна работа в съответствие със стандартите.',
  },
];

// SVG Icons for each service - white for visibility on color overlays
const icons: Record<IconKey, string> = {
  'washing-machine': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="20" x="3" y="2" rx="2"/><circle cx="12" cy="14" r="4"/><circle cx="12" cy="14" r="1"/><path d="M8 6h.01M11 6h.01M14 6h.01"/></svg>`,
  'refrigerator': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2z"/><path d="M5 10h14"/><path d="M9 2v4"/><path d="M9 16v2"/></svg>`,
  'air-conditioner': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 9a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1z"/><path d="M12 12h.01"/><path d="m6 17-2 2"/><path d="m10 17-2 2"/><path d="m14 17 2 2"/><path d="m18 17 2 2"/></svg>`,
  'dishwasher': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M8 16v-4"/><path d="M16 16v-4"/><path d="M8 6h.01"/><path d="M12 6h.01"/><path d="M16 6h.01"/></svg>`,
  'oven': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M7 16h10"/><path d="M7 8h10"/><path d="M7 12h10"/><path d="M7 7v6"/><path d="M17 7v6"/></svg>`,
  'electrical': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 12h4l-1 8 6-11h-4l2-5z"/></svg>`,
  'other': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 3a2 2 0 0 0-2 2"/><path d="M18 3a2 2 0 0 1 2 2"/><path d="M18 21a2 2 0 0 1-2-2"/><path d="M18 21a2 2 0 0 0 2-2"/><path d="M6 3a2 2 0 0 0-2 2"/><path d="M6 3a2 2 0 0 1 2 2"/><path d="M6 21a2 2 0 0 0 2-2"/><path d="M6 21a2 2 0 0 1-2-2"/><path d="M3 9v0"/><path d="M3 15v0"/><path d="M21 9v0"/><path d="M21 15v0"/><path d="M9 3v0"/><path d="M9 21v0"/><path d="M15 3v0"/><path d="M15 21v0"/><path d="M9 12a3 3 0 1 0 6 0 3 3 0 1 0-6 0"/></svg>`,
};
---

<section id="services" class={sectionClass}>
  <!-- Decorative elements to make the section pop -->
  <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue-100 rounded-full opacity-50"></div>
  <div class="absolute -bottom-20 -left-20 w-60 h-60 bg-blue-100 rounded-full opacity-30"></div>

  <div class="container relative z-10">
    <div class="text-center max-w-3xl mx-auto mb-16"> 
      <h2 class={titleClass}>{t('services.title')}</h2>
      <div class="w-24 h-1 bg-primary mx-auto my-4"></div>
      <p class={subtitleClass}>{t('services.subtitle')}</p>
      
      <!-- Service area and guarantee info -->
      <div class="mt-6 flex flex-col sm:flex-row justify-center items-center gap-4">
        <span class="bg-blue-50 text-primary px-5 py-3 rounded-md border border-blue-200 font-medium flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          {serviceArea}
        </span>
        <span class="bg-blue-50 text-primary px-5 py-3 rounded-md border border-blue-200 font-medium flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
            <path d="m9 12 2 2 4-4"></path>
          </svg>
          {guaranteeText}
        </span>
      </div>
    </div>
    
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {services.map(service => {
        const gradientClass = serviceColors[service.icon as keyof typeof serviceColors] || 'from-gray-700/70 to-gray-600/70';
        
        return (
          <div class="relative h-full rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow group">
            <!-- Background image with gradient overlay -->
            <div class="absolute inset-0">
              <img 
                src={`/img/${service.icon}.webp`}
                alt=""
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                width="600"
                height="400"
                loading="lazy"
              />
              <!-- Gradient overlay that maintains good readability even on hover -->
              <div class={`absolute inset-0 bg-gradient-to-br ${gradientClass} group-hover:opacity-75 transition-opacity duration-300`}></div>
              
              <!-- Additional darker gradient at the bottom for better text readability -->
              <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
            </div>
            
            <!-- Content on top of the overlay - cleaner layout without separate cards -->
            <div class="relative z-10 p-8 h-full flex flex-col text-white">
              <div class="flex items-center gap-4 mb-4">
                <div class="text-white drop-shadow-sm">
                  <Fragment set:html={icons[service.icon]} />
                </div>
                <h3 class="text-xl font-semibold drop-shadow-sm">{service.title}</h3>
              </div>
              
              <p class="mt-2 text-white flex-grow drop-shadow text-shadow">{service.description}</p>
              
              <!-- Call to action at the bottom -->
              <div class="mt-6 pt-4 border-t border-white/20">
                <a href="/book" class="text-white hover:text-white/80 font-medium flex items-center drop-shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
                </svg>
                {isEN ? 'Book repair' : 'Запази ремонт'}
                </a>
              </div>
            </div>
          </div>
        );
      })}
    </div>
    
    <!-- Additional CTA at the bottom of services section -->
    <div class="mt-12 text-center">
      <a href="/book" class="btn-cta inline-flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
        </svg>
        {isEN ? 'Schedule a Service' : 'Запази час за ремонт'}
      </a>
    </div>
  </div>
</section>