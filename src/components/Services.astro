---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

// Define a type for valid icon keys
type IconKey = 'washing-machine' | 'dishwasher' | 'oven' | 'electrical' | 'other' | 'dryer';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const isEN = lang === 'en';

// Styling for the section
const sectionClass = "py-16 md:py-24 bg-gradient-to-b from-blue-50 to-white relative overflow-hidden";
const titleClass = "text-3xl md:text-4xl font-bold text-primary mb-2";
const subtitleClass = "mt-4 text-xl text-gray-600 max-w-3xl mx-auto";

// Color overlays for each service type - consistent style with original design
const serviceColors = {
  'washing-machine': 'from-blue-700/80 to-blue-600/80',
  'dishwasher': 'from-emerald-700/80 to-emerald-600/80',
  'oven': 'from-amber-700/80 to-amber-600/80', 
  'electrical': 'from-red-700/80 to-red-600/80',
  'dryer': 'from-indigo-700/80 to-indigo-600/80',
};

// Adding the service area information
const serviceArea = isEN 
  ? 'Serving Varna and surrounding areas (up to 20km)'
  : 'Обслужваме Варна и околностите (до 20км)';

// Service guarantee text
const guaranteeText = isEN
  ? 'All repairs come with professional service and warranty'
  : 'Всички ремонти се извършват професионално и с гаранция';

// In-home service explanation
const inHomeServiceText = isEN
  ? 'All repairs are performed in your home - no need to transport heavy appliances'
  : 'Всички ремонти се извършват във вашия дом - не е нужно да транспортирате тежки уреди';

const services = [
  {
    icon: 'washing-machine' as IconKey,
    title: isEN ? 'Washing Machines & Dryers' : 'Перални и Сушилни',
    description: isEN 
      ? 'Fast repairs for all washing machine and dryer brands. We fix leaks, motor problems, electronics, drum issues, and provide same-day emergency service.'
      : 'Бързи ремонти на всички марки перални и сушилни. Отстраняваме течове, проблеми с мотора, барабана, електрониката и предлагаме спешна услуга в същия ден.',
    url: isEN ? '/en/services/washing-machine-repair' : '/services/washing-machine-repair',
  },
  {
    icon: 'dishwasher' as IconKey,
    title: isEN ? 'Dishwashers' : 'Съдомиялни',
    description: isEN 
      ? 'Reliable dishwasher repairs for all major brands. We fix water inlet problems, draining issues, and electronics with genuine parts. Same-day diagnosis.'
      : 'Надежден ремонт на съдомиялни от всички основни марки. Отстраняваме проблеми с подаването на вода, източването и електрониката с оригинални части. Диагностика в същия ден.',
    url: isEN ? '/en/services/dishwasher-repair' : '/services/dishwasher-repair',
  },
  {
    icon: 'oven' as IconKey,
    title: isEN ? 'Ovens & Water Heaters' : 'Фурни и Бойлери',
    description: isEN 
      ? 'Expert repairs for electric ovens, cooktops, and water heaters. Heating elements, thermostats, and control boards fixed with quality assurance.'
      : 'Експертен ремонт на електрически фурни, котлони и бойлери. Нагревателни елементи, термостати и контролни платки се ремонтират с гаранция за качество.',
    url: isEN ? '/en/services/oven-repair' : '/services/oven-repair',
  },
  {
    icon: 'electrical' as IconKey,
    title: isEN ? 'Electrical Services' : 'Електрически Услуги',
    description: isEN 
      ? 'Installation and replacement of switches, sockets, light fixtures, and small electrical appliances. Safe, reliable, and code-compliant work performed by certified engineers.'
      : 'Монтаж и подмяна на ключове, контакти, осветителни тела и малки електрически уреди. Безопасна, надеждна работа в съответствие със стандартите, извършена от сертифицирани инженери.',
    url: isEN ? '/en/services/electrical-services' : '/services/electrical-services',
  },
];

// SVG Icons for each service
const icons: Record<IconKey, string> = {
  'washing-machine': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="20" x="3" y="2" rx="2"/><circle cx="12" cy="14" r="4"/><circle cx="12" cy="14" r="1"/><path d="M8 6h.01M11 6h.01M14 6h.01"/></svg>`,
  'dishwasher': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M8 16v-4"/><path d="M16 16v-4"/><path d="M8 6h.01"/><path d="M12 6h.01"/><path d="M16 6h.01"/></svg>`,
  'oven': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M7 16h10"/><path d="M7 8h10"/><path d="M7 12h10"/><path d="M7 7v6"/><path d="M17 7v6"/></svg>`,
  'electrical': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 12h4l-1 8 6-11h-4l2-5z"/></svg>`,
  'dryer': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7l16-4"/><path d="M4 17l16-4"/><path d="M4 12h16"/></svg>`,
  'other': `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 3a2 2 0 0 0-2 2"/><path d="M18 3a2 2 0 0 1 2 2"/><path d="M18 21a2 2 0 0 1-2-2"/><path d="M18 21a2 2 0 0 0 2-2"/><path d="M6 3a2 2 0 0 0-2 2"/><path d="M6 3a2 2 0 0 1 2 2"/><path d="M6 21a2 2 0 0 0 2-2"/><path d="M6 21a2 2 0 0 1-2-2"/><path d="M3 9v0"/><path d="M3 15v0"/><path d="M21 9v0"/><path d="M21 15v0"/><path d="M9 3v0"/><path d="M9 21v0"/><path d="M15 3v0"/><path d="M15 21v0"/><path d="M9 12a3 3 0 1 0 6 0 3 3 0 1 0-6 0"/></svg>`,
};
---

<section id="services" class={sectionClass}>
  <!-- Decorative elements to make the section pop -->
  <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue-100 rounded-full opacity-50"></div>
  <div class="absolute -bottom-20 -left-20 w-60 h-60 bg-blue-100 rounded-full opacity-30"></div>

  <div class="container relative z-10">
    <div class="text-center max-w-3xl mx-auto mb-8 md:mb-16"> 
      <h2 class={titleClass}>{t('services.title')}</h2>
      <div class="w-24 h-1 bg-primary mx-auto my-4"></div>
      <p class={subtitleClass}>{t('services.subtitle')}</p>
      
      <!-- Mobile Service Info box -->
      <div class="mt-6 bg-gradient-to-r from-blue-100 to-blue-50 rounded-lg border border-blue-200 mx-auto max-w-2xl overflow-hidden shadow-sm">
        <div class="grid md:grid-cols-3">
          <!-- In-home service -->
          <div class="p-4 border-b md:border-b-0 md:border-r border-blue-200 flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-primary flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <p class="text-sm font-medium text-primary-dark">
              {isEN ? 'We repair at your home' : 'Ремонт във вашия дом'}
            </p>
          </div>
          
          <!-- Service Area -->
          <div class="p-4 border-b md:border-b-0 md:border-r border-blue-200 flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-primary flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <p class="text-sm font-medium text-primary-dark">
              {isEN ? 'Varna area (up to 20km)' : 'Варна и околности (до 20км)'}
            </p>
          </div>
          
          <!-- Warranty -->
          <div class="p-4 flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-primary flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
              <path d="m9 12 2 2 4-4"></path>
            </svg>
            <p class="text-sm font-medium text-primary-dark">
              {isEN ? 'Professional with warranty' : 'Професионално с гаранция'}
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mobile Service Cards -->
    <div class="grid gap-6 md:gap-8 md:grid-cols-2 lg:grid-cols-2">
      {services.map((service, index) => {
        const gradientClass = serviceColors[service.icon as keyof typeof serviceColors] || 'from-gray-700/70 to-gray-600/70';
        
        return (
          <div class="relative rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow group">
            <!-- Background image with enhanced gradient overlay -->
            <div class="absolute inset-0">
              <!-- Optimized images with multiple formats and lazy loading -->
              <picture>
                <source srcset={`/img/${service.icon}.avif`} type="image/avif">
                <source srcset={`/img/${service.icon}.webp`} type="image/webp">
                <img 
                  src={`/img/${service.icon}.webp`}
                  alt=""
                  class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                  width="600"
                  height="400"
                  loading="lazy"
                  decoding="async"
                />
              </picture>
              <!-- Gradient overlay with improved contrast for mobile -->
              <div class={`absolute inset-0 bg-gradient-to-br ${gradientClass} group-hover:opacity-75 transition-opacity duration-300`}></div>
              
              <!-- Additional darker gradient at the bottom for better text readability -->
              <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
            </div>
            
            <!-- Enhanced Content Layout -->
            <div class="relative z-10 p-6 md:p-8 h-full flex flex-col text-white">
              <div class="flex items-center gap-4 mb-4">
                <!-- Icon with improved background for visibility -->
                <div class="p-2 bg-white/20 rounded-full text-white">
                  <Fragment set:html={icons[service.icon]} />
                </div>
                <h3 class="text-xl font-semibold drop-shadow-sm">{service.title}</h3>
              </div>
              
              <p class="mt-2 text-white/90 flex-grow text-shadow">{service.description}</p>
              
              <!-- Enhanced Call to action at the bottom - Updated to use service URLs -->
              <div class="mt-6 pt-4 border-t border-white/20">
                <a href={service.url} class="bg-white/30 hover:bg-white/40 backdrop-blur-sm text-white font-medium py-2 px-4 rounded-lg inline-flex items-center transition-colors shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
                </svg>
                {isEN ? 'Learn More' : 'Научете повече'}
                </a>
              </div>
            </div>
          </div>
        );
      })}
    </div>
    
    <!-- CTA at the bottom of services section - PHONE ONLY NOW -->
    <div class="mt-12 text-center">
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="tel:+359898340982" class="btn-primary inline-flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
          </svg>
          {isEN ? 'Call Now' : 'Обадете се сега'}
        </a>
        
        <!-- COMMENTED OUT - BOOKING DISABLED
        <a href={isEN ? '/en/book' : '/book'} class="btn-cta inline-flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
          </svg>
          {isEN ? 'Book Service' : 'Запази час'}
        </a>
        -->
        
        <!-- Alternative contact method - Email -->
        <a href="mailto:n.ivanov.ivanov@abv.bg" class="btn-cta inline-flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          {isEN ? 'Send Email' : 'Изпратете имейл'}
        </a>
        
        <!-- Additional info text for phone booking -->
        <div class="flex items-center text-gray-600 text-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 6v6l4 2"/><circle cx="12" cy="12" r="10"/>
          </svg>
          <span>{isEN ? 'Call to schedule' : 'Обадете се за час'}</span>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Add drop shadow for good text readability on mobile */
  .text-shadow {
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  }
</style>